<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Planta¬∑Gochi ‚Äî Care Dashboard</title>

  <!-- Bootstrap 5 & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --leaf: #3a7f49;         /* deep garden green */
      --leaf-2:#6fbf73;        /* fresh leaf */
      --stem:#2b4633;          /* muted dark green */
      --stone:#f3f5f2;         /* light stone background */
      --accent:#95d5b2;        /* minty accent */
    }
    html,body{background:linear-gradient(180deg, var(--stone), #ffffff) fixed; color:#122; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";}
    .hero{
      position: relative;
      padding-top: 5rem;
      padding-bottom: 2rem;
      background:
              radial-gradient(1200px 400px at 50% -20%, rgba(149,213,178,.35), transparent 60%),
              linear-gradient(180deg, rgba(111,191,115,.12), transparent 40%);
      overflow:hidden;
    }
    .brand-badge{
      display:inline-flex; gap:.5rem; align-items:center;
      padding:.35rem .75rem; border-radius:999px; background:rgba(149,213,178,.18); color:var(--stem);
      backdrop-filter: blur(6px); font-weight:600; font-size:.9rem;
    }
    .plant-card{
      border:0; border-radius:1.25rem; background:#fff; box-shadow:0 8px 30px rgba(20,50,34,.07);
    }
    .plant-img{
      border-radius:1.25rem; width:100%; aspect-ratio: 16/9; object-fit:cover; transition: transform .6s ease;
      box-shadow: 0 10px 30px rgba(42,87,57,.15);
    }
    .plant-img:hover{ transform: scale(1.02); }
    .metric{
      border-radius:1rem; background:linear-gradient(180deg, #ffffff, #f7faf7); border:1px solid #eaf3ea; padding:1rem 1.2rem;
      transition: box-shadow .3s ease, transform .3s ease;
    }
    .metric:hover{ box-shadow:0 10px 24px rgba(34,64,46,.08); transform: translateY(-2px); }
    .metric .icon{
      width:2.4rem; height:2.4rem; border-radius:.8rem; display:grid; place-items:center; background:rgba(111,191,115,.15);
    }
    .metric .value{ font-size:1.6rem; font-weight:800; color:var(--stem); letter-spacing: .2px;}
    .metric .sub{ color:#466054; font-size:.9rem;}
    .pill{
      display:inline-flex; align-items:center; gap:.4rem; padding:.25rem .6rem; border-radius:999px; background:rgba(58,127,73,.08);
      font-size:.8rem; color:var(--leaf); font-weight:600;
    }
    .footer-note{ color:#466054;}
    .fade-in{ animation: fadein .6s ease both; }
    @keyframes fadein{ from{opacity:0; transform: translateY(6px);} to{opacity:1; transform:none;} }
  </style>
</head>
<body>
<header class="hero">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center">
      <div class="brand-badge"><i class="bi bi-flower1"></i> Planta¬∑Gochi</div>
      <span class="pill"><i class="bi bi-shield-check"></i> Minimal ‚Ä¢ Smooth ‚Ä¢ Garden</span>
    </div>
    <h1 class="display-5 fw-bold mt-4" style="font-family:'Playfair Display', serif; color:var(--stem)">
      Nurture your plant, beautifully
    </h1>
    <p class="lead text-muted">Live insights on humidity, temperature, light, and moisture‚Äîstyled with care.</p>
  </div>
</header>

<main class="container pb-5">
  <!-- Plant header -->
  <div class="row g-4 align-items-stretch">
    <div class="col-lg-7">
      <div class="plant-card p-3 fade-in">
        <img id="plantImage" class="plant-img" alt="Plant image" src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1400&auto=format&fit=crop" />
      </div>
    </div>
    <div class="col-lg-5">
      <div class="plant-card p-4 h-100 fade-in">
        <div class="d-flex align-items-center gap-3">
          <div class="icon rounded" style="background:rgba(58,127,73,.1); width:3rem;height:3rem; display:grid; place-items:center;">
            <i class="bi bi-leaf" style="font-size:1.4rem;color:var(--leaf)"></i>
          </div>
          <div>
            <div id="plantName" class="h4 mb-0">Loading name‚Ä¶</div>
            <div id="plantLatin" class="text-muted fst-italic">‚Äî</div>
          </div>
        </div>
        <div class="mt-3">
          <span id="availabilityPill" class="pill"><i class="bi bi-circle-fill" style="font-size:.6rem"></i> Availability</span>
          <span id="appealPill" class="pill ms-2"><i class="bi bi-sparkles"></i> Appeal</span>
        </div>
        <hr class="my-4">
        <div class="small text-muted">
          <i class="bi bi-link-45deg"></i> <a id="sourceLink" href="#" target="_blank" class="link-success link-underline-opacity-0">More about this plant</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Metrics -->
  <section class="mt-5">
    <div class="row g-4">
      <div class="col-12 col-sm-6 col-xl-3">
        <div class="metric h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="icon"><i class="bi bi-thermometer-half"></i></div>
            <span class="pill">Temp (¬∞C)</span>
          </div>
          <div class="value" id="valTemp">‚Äî</div>
          <div class="sub">Ideal: <span id="idealTemp">‚Äî</span> ‚Ä¢ Range: <span id="rangeTemp">‚Äî</span></div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-xl-3">
        <div class="metric h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="icon"><i class="bi bi-droplet-half"></i></div>
            <span class="pill">Humidity (%)</span>
          </div>
          <div class="value" id="valHum">‚Äî</div>
          <div class="sub">Ideal: <span id="idealHum">‚Äî</span> ‚Ä¢ Range: <span id="rangeHum">‚Äî</span></div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-xl-3">
        <div class="metric h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="icon"><i class="bi bi-brightness-high"></i></div>
            <span class="pill">Light (0‚Äì4000)</span>
          </div>
          <div class="value" id="valLight">‚Äî</div>
          <div class="sub">Ideal: <span id="idealLight">‚Äî</span> ‚Ä¢ Range: <span id="rangeLight">‚Äî</span></div>
        </div>
      </div>
      <div class="col-12 col-sm-6 col-xl-3">
        <div class="metric h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="icon"><i class="bi bi-moisture"></i></div>
            <span class="pill">Moisture (0‚Äì4000)</span>
          </div>
          <div class="value" id="valMoist">‚Äî</div>
          <div class="sub">Ideal: <span id="idealMoist">‚Äî</span> ‚Ä¢ Range: <span id="rangeMoist">‚Äî</span></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bottom info text -->
  <section class="mt-5">
    <div class="plant-card p-4">
      <h5 class="mb-3" style="color:var(--stem)"><i class="bi bi-journal-text me-2"></i> More about your plant</h5>
      <div id="moreInfo" class="footer-note small">Loading details‚Ä¶</div>
    </div>
    <p class="text-center text-muted small mt-3">0 is brightest light / most moist ‚Ä¢ 4000 is darkest / driest.</p>
  </section>
</main>

<!-- Firebase SDKs -->
<script type="module">
  // Import the required Firebase modules from CDN
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // üîß Your Firebase configuration (replace with your actual project settings)
  const firebaseConfig = {
    apiKey: "AIzaSyAnbRePsjQ729mrtSOt9G6PM2ehQOWlTB8",
    authDomain: "planta-gochi.firebaseapp.com",
    projectId: "planta-gochi",
    storageBucket: "planta-gochi.firebasestorage.app",
    messagingSenderId: "85861190517",
    appId: "1:85861190517:web:273624fd74a5e1d281213c",
    measurementId: "G-N6KHT2TSEC"
  };


  // Initialize Firebase and Firestore
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // üîç Load Plant Document
  async function loadPlant() {
    const urlParams = new URLSearchParams(window.location.search);
    const plantId = urlParams.get("id"); // using ?id= not ?plant_id=
    if (!plantId) {
      document.getElementById("plantName").textContent = "No plant id provided.";
      return;
    }

    try {
      // Get document with matching ID
      const docRef = doc(db, "plants", plantId);
      const docSnap = await getDoc(docRef);

      if (!docSnap.exists()) {
        document.getElementById("plantName").textContent = "Plant not found.";
        return;
      }

      const data = docSnap.data();

      // --- Header ---
      document.getElementById("plantName").textContent = data?.name ?? "‚Äî";
      document.getElementById("plantLatin").textContent = data?.scientific_name ?? "‚Äî";
      document.getElementById("plantImage").src = data?.image || document.getElementById("plantImage").src;

      const url = data?.Url || data?.url || "#";
      document.getElementById("sourceLink").href = url;
      document.getElementById("availabilityPill").innerHTML =
              `<i class="bi bi-circle-fill" style="font-size:.6rem"></i> ${data?.house_plant_api_data?.Avaibility ?? "‚Äî"}`;
      document.getElementById("appealPill").innerHTML =
              `<i class="bi bi-sparkles"></i> ${data?.house_plant_api_data?.Appeal ?? "‚Äî"}`;

      // --- Sensor Values ---
      const last = (arr) => Array.isArray(arr) && arr.length ? arr[arr.length - 1] : "‚Äî";
      document.getElementById("valTemp").textContent = last(data?.plant_temperature);
      document.getElementById("valHum").textContent = last(data?.plant_humidity);
      document.getElementById("valLight").textContent = last(data?.plant_light_exposure);
      document.getElementById("valMoist").textContent = last(data?.plant_moisture);

      // --- Ideal Values ---
      document.getElementById("idealTemp").textContent = data?.ideal_temperature ?? "‚Äî";
      document.getElementById("idealHum").textContent = data?.ideal_humidity ?? "‚Äî";
      document.getElementById("idealLight").textContent = data?.ideal_light_exposure ?? "‚Äî";
      document.getElementById("idealMoist").textContent = data?.ideal_moisture ?? "‚Äî";

      // --- Sick State Ranges ---
      const r = data?.sick_state ?? {};
      const fmtRange = (a) => Array.isArray(a) ? `${a[0]} ‚Äì ${a[1]}` : "‚Äî";
      document.getElementById("rangeTemp").textContent = fmtRange(r.temperature);
      document.getElementById("rangeHum").textContent = fmtRange(r.humidity);
      document.getElementById("rangeLight").textContent = fmtRange(r.light_exposure);
      document.getElementById("rangeMoist").textContent = fmtRange(r.moisture);

      // --- More Info HTML ---
      document.getElementById("moreInfo").innerHTML =
              data?.more_info_html ? `<div class="small">${data.more_info_html}</div>` : "‚Äî";

    } catch (err) {
      console.error("Error loading plant:", err);
      document.getElementById("moreInfo").textContent = "Failed to load plant data.";
    }
  }

  loadPlant();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
